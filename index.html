<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DKJ KNOWLEDGE JACKPOT</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --gold: #c5a059; --dark: #0f2027; --tg-blue: #0088cc; }
        body { font-family: sans-serif; background: #f4f4f4; margin: 0; padding-bottom: 80px; -webkit-tap-highlight-color: transparent; }
        .header { background: var(--dark); color: var(--gold); padding: 15px; text-align: center; border-bottom: 3px solid var(--gold); cursor: pointer; }
        .marquee-box { background: #000; color: #fff; padding: 5px; font-weight: bold; border-bottom: 1px solid var(--gold); }
        .card { background: white; margin: 12px; padding: 20px; border-radius: 15px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); text-align: center; }
        .bal-text { font-size: 35px; color: #27ae60; font-weight: bold; margin: 10px 0; }
        .pg-container { background: #ddd; height: 12px; border-radius: 10px; margin: 10px 0; overflow: hidden; }
        .pg-bar { background: var(--gold); height: 100%; width: 0%; transition: 0.5s; }
        .btn { width: 100%; padding: 14px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; display: block; box-sizing: border-box; text-decoration: none; text-align: center; font-size: 14px; }
        .btn-dark { background: var(--dark); color: white; }
        .btn-gold { background: var(--gold); color: black; }
        .btn-tg { background: var(--tg-blue); color: white; }
        .scroll-box { display: flex; overflow-x: auto; padding: 10px; gap: 15px; scrollbar-width: none; }
        .draw-box { min-width: 160px; background: white; padding: 15px; border-radius: 12px; border: 2px solid var(--dark); text-align: center; color: #000; }
        #popup { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.98); z-index: 1000; color: white; padding: 20px; box-sizing: border-box; text-align: center; overflow-y: auto; }
        input { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: none; font-weight: bold; color: #000; outline: none; box-sizing: border-box; }
        .list-item { background: #222; padding: 12px; border-radius: 8px; margin-bottom: 8px; text-align: left; border-left: 4px solid var(--gold); cursor: pointer; color: white; }
        .win-amt { float: right; color: #27ae60; font-weight: bold; }
        #congrats { display:none; color: gold; font-size: 20px; font-weight: bold; animation: blink 1s infinite; margin-top:10px; text-align:center; }
        @keyframes blink { 0% {opacity: 1;} 50% {opacity: 0.2;} 100% {opacity: 1;} }
    </style>
</head>
<body>

<div class="marquee-box"><marquee>üî• DKJ Mega Draw: Win Lakhs of Rupees Every Day! Join Now! üî•</marquee></div>

<div class="header" onclick="adminMode()">
    <h1 style="margin:0; font-size:18px;">DKJ KNOWLEDGE JACKPOT</h1>
    <div id="uHi" style="font-size: 11px; color: white; margin-top: 5px;">Welcome Guest (Admin: Tap)</div>
</div>

<div id="congrats">üéä CONGRATULATIONS! YOU WON! üéä</div>

<div class="card">
    <p style="margin:0; font-weight:bold; color: #666;">MY WALLET BALANCE</p>
    <div class="bal-text" id="vBal">‚Çπ0</div>
    <button class="btn btn-dark" onclick="showWithdrawForm()">WITHDRAW MONEY</button>
</div>

<div class="card">
    <p style="margin:0; font-size:12px; font-weight:bold;">DRAW PROGRESS: <span id="pgTxt">0%</span></p>
    <div class="pg-container"><div class="pg-bar" id="pBar"></div></div>
    <button class="btn btn-gold" onclick="copyInvite()">COPY INVITE LINK</button>
</div>

<div class="scroll-box">
    <div class="draw-box" style="border-color: var(--gold);"><h3>MEGA</h3><h2>‚Çπ100</h2><button class="btn btn-dark" onclick="join(100)">JOIN NOW</button></div>
    <div class="draw-box" style="opacity:0.6; background:#eee;"><h3>SILVER</h3><h2>‚Çπ200</h2><button class="btn" style="background:#888; color:white; cursor:not-allowed;">LOCKED</button></div>
    <div class="draw-box" style="opacity:0.6; background:#eee;"><h3>GOLD</h3><h2>‚Çπ500</h2><button class="btn" style="background:#888; color:white; cursor:not-allowed;">LOCKED</button></div>
</div>

<div style="padding: 10px;">
    <button id="rBtn" class="btn btn-gold" onclick="showReg()">‚ûï CREATE ACCOUNT</button>
    <button id="lBtn" class="btn btn-dark" onclick="showLogin()">üîë LOGIN ACCOUNT</button>
    <button class="btn btn-dark" onclick="showProfile()">üë§ MY PROFILE & CODES</button>
    <button class="btn btn-gold" onclick="showWinners()">üèÜ TOP WINNERS</button>
    <button class="btn" style="background:#444; color:white;" onclick="showTC()">üìÑ TERMS & CONDITIONS</button>
    <a href="https://t.me/dkj_knowledge_jackoprt" target="_blank" class="btn btn-tg">üì¢ TELEGRAM CHANNEL</a>
</div>

<div id="popup">
    <div id="pContent"></div>
    <button onclick="closeP()" style="margin-top:20px; background:red; color:white; border:none; padding:10px 40px; border-radius:10px; font-weight:bold;">CLOSE</button>
</div>

<script>
    // Firebase Init
    const firebaseConfig = {
        apiKey: "AIzaSyBcdlUy_CAFZbQPPzOzGTkofvvSSdXe6r4",
        authDomain: "dkj-jackpot.firebaseapp.com",
        databaseURL: "https://dkj-jackpot-default-rtdb.firebaseio.com",
        projectId: "dkj-jackpot",
        storageBucket: "dkj-jackpot.firebasestorage.app",
        messagingSenderId: "598164039811",
        appId: "1:598164039811:web:27420c0d7ecedf28fb53b6"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const TG_BOT = "8357735991:AAHUnhnXj0MaNi-Z1XtitwMy994xssKRsyg";
    const TG_ID = "8072402346";

    let currentUser = JSON.parse(localStorage.getItem('dkj_user_login'));

    // Functions Global banana zaroori hai
    window.closeP = function() { document.getElementById('popup').style.display = 'none'; }

    window.showReg = function() {
        document.getElementById('pContent').innerHTML = `<h2>REGISTER</h2><input id="rn" placeholder="Full Name"><input id="rm" type="number" placeholder="Mobile Number"><input id="rp" type="password" placeholder="Set Password"><button class="btn btn-gold" onclick="doReg()">CREATE ACCOUNT</button>`;
        document.getElementById('popup').style.display = 'block';
    }

    window.doReg = function() {
        let n = document.getElementById('rn').value, m = document.getElementById('rm').value, p = document.getElementById('rp').value;
        if(!n || !m || !p) return alert("All fields are required!");
        database.ref('users/' + m).set({ name: n, mob: m, pass: p, bal: 0, codes: ["None"], isWinner: false }).then(() => {
            alert("Account Created!");
            window.doLoginManual(m, p);
        });
    }

    window.showLogin = function() {
        document.getElementById('pContent').innerHTML = `<h2>LOGIN</h2><input id="lm" type="number" placeholder="Mobile Number"><input id="lp" type="password" placeholder="Password"><button class="btn btn-gold" onclick="doLogin()">LOGIN NOW</button>`;
        document.getElementById('popup').style.display = 'block';
    }

    window.doLogin = function() {
        let m = document.getElementById('lm').value, p = document.getElementById('lp').value;
        window.doLoginManual(m, p);
    }

    window.doLoginManual = function(m, p) {
        database.ref('users/' + m).once('value', s => {
            let u = s.val();
            if(u && u.pass == p) {
                localStorage.setItem('dkj_user_login', JSON.stringify(u));
                location.reload();
            } else { alert("Invalid Credentials!"); }
        });
    }

    window.showProfile = function() {
        if(!currentUser) return alert("Please Login First!");
        let t = Array.isArray(currentUser.codes) ? currentUser.codes.filter(x=>x!=="None").join(", ") : "None";
        document.getElementById('pContent').innerHTML = `<h2>MY PROFILE</h2><p><b>Name:</b> ${currentUser.name}</p><p><b>ID (Mob):</b> ${currentUser.mob}</p><p><b>My Tickets:</b> ${t || "No Tickets"}</p><button class="btn btn-dark" onclick="logout()">LOGOUT</button>`;
        document.getElementById('popup').style.display = 'block';
    }

    window.join = function(amt) {
        if(!currentUser) return alert("Please Login!");
        database.ref('pending/' + currentUser.mob).once('value', s => {
            if(s.exists()) return alert("Your previous payment is already pending!");
            document.getElementById('pContent').innerHTML = `<h2>PAY ‚Çπ${amt}</h2><p>Scan & Pay via UPI</p><img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=upi://pay?pa=paytmqr6vnhle@ptys%26am=${amt}"><button class="btn btn-gold" onclick="requestPay()">I HAVE PAID</button>`;
            document.getElementById('popup').style.display = 'block';
        });
    }

    window.requestPay = function() {
        database.ref('pending/' + currentUser.mob).set({ name: currentUser.name, mob: currentUser.mob });
        fetch(`https://api.telegram.org/bot${TG_BOT}/sendMessage?chat_id=${TG_ID}&text=üí∞ NEW PAYMENT: ${currentUser.name} (${currentUser.mob})`);
        alert("Request Sent!"); closeP();
    }

    window.showWinners = function() {
        database.ref('winners').once('value', s => {
            let h = "<h2>üèÜ WINNERS LIST</h2>";
            let real = []; s.forEach(c => { real.push(c.val()); });
            real.reverse().forEach(w => {
                h += `<div class="list-item"><span class="win-amt">‚Çπ${w.prize}</span><b>${w.name}</b><br><small>ID: ${w.mob} | Ticket: ${w.code}</small></div>`;
            });
            document.getElementById('pContent').innerHTML = h || "No Winners Yet!";
            document.getElementById('popup').style.display = 'block';
        });
    }

    window.showWithdrawForm = function() {
        if(!currentUser || currentUser.bal < 10) return alert("Minimum ‚Çπ10 needed!");
        document.getElementById('pContent').innerHTML = `<h2>WITHDRAW</h2><input id="w1" placeholder="Owner Name"><input id="w2" placeholder="Bank Name"><input id="w3" placeholder="A/c Number"><input id="w4" placeholder="IFSC Code"><button class="btn btn-gold" onclick="doWithdraw()">SUBMIT</button>`;
        document.getElementById('popup').style.display = 'block';
    }

    window.doWithdraw = function() {
        let details = `Bank: ${document.getElementById('w2').value}, A/c: ${document.getElementById('w3').value}`;
        fetch(`https://api.telegram.org/bot${TG_BOT}/sendMessage?chat_id=${TG_ID}&text=üí∏ WITHDRAW: ${currentUser.name} (${currentUser.mob})\nAmt: ‚Çπ${currentUser.bal}\nDetails: ${details}`);
        alert("Withdrawal Request Sent!"); closeP();
    }

    window.adminMode = function() {
        let pw = prompt("Admin PW:"); if(pw !== "7860") return;
        let act = prompt("1: Pending Payments\n2: Pick Winner");
        if(act=="1") {
            database.ref('pending').once('value', s => {
                let h = "<h2>Approvals</h2>";
                s.forEach(c => {
                    let u = c.val(); let code = "DKJ-"+Math.floor(1000+Math.random()*9000);
                    h += `<div class="list-item" onclick="approveUser('${u.mob}','${code}')">Approve ${u.name} (${u.mob})<br>Code: ${code}</div>`;
                });
                document.getElementById('pContent').innerHTML = h || "No Pending";
                document.getElementById('popup').style.display = 'block';
            });
        } else if(act=="2") {
            database.ref('users').once('value', s => {
                let h = "<h2>Users with Tickets</h2>";
                s.forEach(c => {
                    let u = c.val();
                    if(u.codes && u.codes.length > 1) {
                        h += `<div class="list-item" onclick="makeWinner('${u.mob}')">${u.name} (${u.mob})</div>`;
                    }
                });
                document.getElementById('pContent').innerHTML = h || "No users";
                document.getElementById('popup').style.display = 'block';
            });
        }
    }

    window.approveUser = function(m, c) {
        database.ref('users/'+m+'/codes').push(c);
        database.ref('pending/'+m).remove();
        alert("Approved!"); closeP();
    }

    window.makeWinner = function(m) {
        let amt = prompt("Prize Amount?"); let cod = prompt("Winner Ticket Code?");
        database.ref('users/'+m).once('value', s => {
            let u = s.val();
            database.ref('winners').push({ name: u.name, mob: m, prize: amt, code: cod });
            database.ref('users/'+m).update({ bal: (u.bal||0)+parseInt(amt), isWinner: true });
            alert("Winner Added!"); closeP();
        });
    }

    window.copyInvite = function() {
        navigator.clipboard.writeText(window.location.href);
        alert("Link Copied!");
    }

    window.showTC = function() {
        document.getElementById('pContent').innerHTML = `<h2>TERMS</h2><p>1. Only one account per person.<br>2. Withdraw takes 24h.<br>3. Admin decision is final.</p>`;
        document.getElementById('popup').style.display = 'block';
    }

    window.logout = function() { localStorage.clear(); location.reload(); }

    // Sync Data
    database.ref('/').on('value', (snapshot) => {
        const data = snapshot.val() || {};
        const users = data.users || {};
        if(currentUser && users[currentUser.mob]) {
            currentUser = users[currentUser.mob];
            document.getElementById('uHi').innerText = "Hi, " + currentUser.name + " (ID: "+currentUser.mob+")";
            document.getElementById('vBal').innerText = "‚Çπ" + (currentUser.bal || 0);
            document.getElementById('rBtn').style.display = 'none';
            document.getElementById('lBtn').style.display = 'none';
            document.getElementById('congrats').style.display = currentUser.isWinner ? "block" : "none";
        }
        let count = Object.keys(users).length;
        let p = Math.min((count / 1000) * 100, 100);
        document.getElementById('pBar').style.width = p + "%";
        document.getElementById('pgTxt').innerText = Math.floor(p) + "%";
    });

</script>
</body>
</html>
